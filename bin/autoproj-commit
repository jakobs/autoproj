#! /usr/bin/env ruby

require 'autoproj'
require 'autoproj/cmdline'
require 'autoproj/ops/snapshot'
require 'pp'

current_dir = Dir.pwd
remaining_args = Autoproj.silent do
    Autoproj::CmdLine.initialize_root_directory
    Autoproj::CmdLine.initialize_and_load(ARGV)
end

user_selection = remaining_args.map do |arg|
    if File.directory?(arg)
        File.expand_path(arg)
    else arg
    end
end
versions_file = File.join( Autoproj.overrides_dir, "50-versions.yml" )
Autoproj::CmdLine.report do
    packages = Autoproj::Ops::Snapshot.resolve_selection user_selection
    ops = Autoproj::Ops::Snapshot.new(Autoproj.manifest)
    ops.snapshot_package_sets
    ops.snapshot_packages(packages)
    ops.save_versions versions_file
end

